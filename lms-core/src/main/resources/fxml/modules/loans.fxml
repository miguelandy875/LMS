<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.text.*?>

<ScrollPane stylesheets="@../../styles/modules.css" styleClass="module-container"
   fitToWidth="true" xmlns="http://javafx.com/javafx/23.0.1" xmlns:fx="http://javafx.com/fxml/1"
   fx:controller="com.lms.controller.modules.LoanController">

   <VBox spacing="25.0" styleClass="module-container" maxWidth="Infinity">
      <children>

         <!-- Header Section -->
         <HBox alignment="CENTER_LEFT" spacing="15.0" styleClass="module-header">
            <children>
               <Label style="-fx-text-fill: #FF6B35;" styleClass="module-icon" text="🔄" />
               <VBox>
                  <children>
                     <Label styleClass="module-title" text="Loan Management" />
                     <Label styleClass="module-subtitle" text="Manage book loans and returns" />
                  </children>
               </VBox>
               <Region HBox.hgrow="ALWAYS" />
            </children>
            <padding>
               <Insets bottom="20.0" left="20.0" right="20.0" top="10.0" />
            </padding>
         </HBox>

         <!-- Statistics Cards - FIXED COLUMN CONSTRAINTS -->
         <GridPane hgap="15.0" styleClass="stats-container" vgap="15.0" maxWidth="Infinity">
            <columnConstraints>
               <ColumnConstraints hgrow="ALWAYS" minWidth="150.0" prefWidth="200.0"
                  maxWidth="Infinity" percentWidth="16.67" />
               <ColumnConstraints hgrow="ALWAYS" minWidth="150.0" prefWidth="200.0"
                  maxWidth="Infinity" percentWidth="16.67" />
               <ColumnConstraints hgrow="ALWAYS" minWidth="150.0" prefWidth="200.0"
                  maxWidth="Infinity" percentWidth="16.67" />
               <ColumnConstraints hgrow="ALWAYS" minWidth="150.0" prefWidth="200.0"
                  maxWidth="Infinity" percentWidth="16.67" />
               <ColumnConstraints hgrow="ALWAYS" minWidth="150.0" prefWidth="200.0"
                  maxWidth="Infinity" percentWidth="16.67" />
               <ColumnConstraints hgrow="ALWAYS" minWidth="150.0" prefWidth="200.0"
                  maxWidth="Infinity" percentWidth="16.67" />
            </columnConstraints>
            <rowConstraints>
               <RowConstraints minHeight="100.0" prefHeight="120.0" vgrow="SOMETIMES" />
            </rowConstraints>
            <children>

               <!-- Total Loans Card -->
               <VBox alignment="CENTER" styleClass="stat-card, stat-card-primary"
                  GridPane.columnIndex="0" maxWidth="Infinity">
                  <children>
                     <Label fx:id="totalLoansLabel" styleClass="stat-number" text="0" />
                     <Label styleClass="stat-label" text="Total Loans" />
                  </children>
               </VBox>

               <!-- Active Loans Card -->
               <VBox alignment="CENTER" styleClass="stat-card, stat-card-info"
                  GridPane.columnIndex="1" maxWidth="Infinity">
                  <children>
                     <Label fx:id="activeLoansLabel" styleClass="stat-number" text="0" />
                     <Label styleClass="stat-label" text="Active Loans" />
                  </children>
               </VBox>

               <!-- Overdue Loans Card -->
               <VBox alignment="CENTER" styleClass="stat-card, stat-card-danger"
                  GridPane.columnIndex="2" maxWidth="Infinity">
                  <children>
                     <Label fx:id="overdueLoansLabel" styleClass="stat-number" text="0" />
                     <Label styleClass="stat-label" text="Overdue" />
                  </children>
               </VBox>

               <!-- Due Soon Card -->
               <VBox alignment="CENTER" styleClass="stat-card, stat-card-warning"
                  GridPane.columnIndex="3" maxWidth="Infinity">
                  <children>
                     <Label fx:id="dueSoonLoansLabel" styleClass="stat-number" text="0" />
                     <Label styleClass="stat-label" text="Due Soon" />
                  </children>
               </VBox>

               <!-- Returned Loans Card -->
               <VBox alignment="CENTER" styleClass="stat-card, stat-card-success"
                  GridPane.columnIndex="4" maxWidth="Infinity">
                  <children>
                     <Label fx:id="returnedLoansLabel" styleClass="stat-number" text="0" />
                     <Label styleClass="stat-label" text="Returned" />
                  </children>
               </VBox>

               <!-- Total Members Card -->
               <VBox alignment="CENTER" styleClass="stat-card, stat-card-secondary"
                  GridPane.columnIndex="5" maxWidth="Infinity">
                  <children>
                     <Label fx:id="totalMembersLabel" styleClass="stat-number" text="0" />
                     <Label styleClass="stat-label" text="Active Members" />
                  </children>
               </VBox>

            </children>
         </GridPane>

         <!-- Search and Filter Section - FIXED WIDTH CONSTRAINTS -->
         <HBox alignment="CENTER_LEFT" spacing="15.0" styleClass="filter-section"
            maxWidth="Infinity">
            <children>
               <!-- Search Field -->
               <VBox spacing="5.0">
                  <children>
                     <Label styleClass="filter-label" text="Search Loans" />
                     <TextField fx:id="searchField" prefWidth="300.0" maxWidth="300.0"
                        styleClass="search-field"
                        promptText="Search by member name, email, or book title..." />
                  </children>
               </VBox>

               <!-- Status Filter -->
               <VBox spacing="5.0">
                  <children>
                     <Label styleClass="filter-label" text="Filter by Status" />
                     <ComboBox fx:id="statusFilter" prefWidth="150.0" maxWidth="150.0"
                        styleClass="filter-combo" />
                  </children>
               </VBox>

               <Region HBox.hgrow="ALWAYS" />

               <!-- Page Size Selection -->
               <VBox spacing="5.0">
                  <children>
                     <Label styleClass="filter-label" text="Page Size" />
                     <ComboBox fx:id="pageSizeCombo" prefWidth="80.0" maxWidth="80.0"
                        styleClass="filter-combo" />
                  </children>
               </VBox>

               <!-- Action Buttons -->
               <HBox spacing="10.0" styleClass="action-buttons">
                  <children>
                     <Button fx:id="clearFiltersButton" mnemonicParsing="false"
                        onAction="#handleClearFilters"
                        prefHeight="35.0" styleClass="secondary-button" text="Clear Filters">
                        <HBox.margin>
                           <Insets top="22.0" />
                        </HBox.margin>
                     </Button>
                     <Button fx:id="issueLoanButton" mnemonicParsing="false"
                        onAction="#handleIssueLoan"
                        prefHeight="35.0" styleClass="primary-button" text="➕ Issue Loan">
                        <HBox.margin>
                           <Insets top="22.0" />
                        </HBox.margin>
                     </Button>
                  </children>
               </HBox>
            </children>
            <padding>
               <Insets bottom="15.0" left="20.0" right="20.0" top="15.0" />
            </padding>
         </HBox>

         <!-- Loans Table Section - FIXED TABLE WIDTH -->
         <VBox spacing="10.0" styleClass="table-section" VBox.vgrow="ALWAYS" maxWidth="Infinity">
            <children>

               <!-- Table Actions -->
               <HBox alignment="CENTER_LEFT" spacing="10.0" styleClass="table-actions">
                  <children>
                     <Label styleClass="table-info" text="Select a loan to perform actions:" />

                     <Region HBox.hgrow="ALWAYS" />

                     <Button fx:id="refreshButton" mnemonicParsing="false" onAction="#handleRefresh"
                        prefHeight="35.0" styleClass="btn-secondary" text="🔄" />
                     <Button fx:id="viewLoanButton" disable="true" mnemonicParsing="false"
                        onAction="#handleViewLoan"
                        prefHeight="35.0" styleClass="btn-secondary" text="👁" />
                     <Button fx:id="returnBookButton" disable="true" mnemonicParsing="false"
                        onAction="#handleReturnBook"
                        prefHeight="35.0" styleClass="btn-secondary" text="📤" />
                     <Button fx:id="renewLoanButton" disable="true" mnemonicParsing="false"
                        onAction="#handleRenewLoan"
                        prefHeight="35.0" styleClass="btn-secondary" text="🔂" />
                     <Button fx:id="deleteLoanButton" disable="true" mnemonicParsing="false"
                        onAction="#handleDeleteLoan"
                        prefHeight="35.0" styleClass="btn-danger" text="❌ " />
                  </children>
               </HBox>

               <!-- Loans Table - FIXED COLUMN CONSTRAINTS -->
               <TableView fx:id="loansTable" styleClass="data-table" VBox.vgrow="ALWAYS"
                  maxWidth="Infinity">
                  <columns>
                     <TableColumn fx:id="idColumn" prefWidth="60.0" minWidth="60.0" maxWidth="80.0"
                        text="ID" />
                     <TableColumn fx:id="memberColumn" prefWidth="200.0" minWidth="180.0"
                        text="Member" />
                     <TableColumn fx:id="bookColumn" prefWidth="180.0" minWidth="160.0" text="Book" />
                     <TableColumn fx:id="issueDateColumn" prefWidth="100.0" minWidth="90.0"
                        maxWidth="120.0" text="Issue Date" />
                     <TableColumn fx:id="dueDateColumn" prefWidth="100.0" minWidth="90.0"
                        maxWidth="120.0" text="Due Date" />
                     <TableColumn fx:id="statusColumn" prefWidth="120.0" minWidth="100.0"
                        maxWidth="150.0" text="Status" />
                     <TableColumn fx:id="fineColumn" prefWidth="80.0" minWidth="70.0"
                        maxWidth="100.0" text="Fine" />
                  </columns>
                  <columnResizePolicy>
                     <TableView fx:constant="CONSTRAINED_RESIZE_POLICY" />
                  </columnResizePolicy>
               </TableView>

               <!-- Pagination Controls -->
               <HBox alignment="CENTER" spacing="15.0" styleClass="pagination-section">
                  <children>
                     <!-- Navigation Buttons -->
                     <HBox spacing="5.0" styleClass="pagination-nav">
                        <children>
                           <Button fx:id="firstPageBtn" styleClass="pagination-btn" text="⏮" />
                           <Button fx:id="previousPageBtn" styleClass="pagination-btn" text="◀" />
                           <Button fx:id="nextPageBtn" styleClass="pagination-btn" text="▶" />
                           <Button fx:id="lastPageBtn" styleClass="pagination-btn" text="⏭" />
                        </children>
                     </HBox>

                     <!-- Page Information -->
                     <Label fx:id="pageInfoLabel" styleClass="page-info"
                        text="Page 1 of 1 (1-25 of 25 records)" />

                     <Region HBox.hgrow="ALWAYS" />

                     <!-- Go to Page -->
                     <HBox alignment="CENTER_RIGHT" spacing="5.0" styleClass="goto-page">
                        <children>
                           <Label styleClass="pagination-label" text="Go to page:" />
                           <TextField fx:id="goToPageField" prefWidth="60.0" maxWidth="60.0"
                              promptText="1" styleClass="goto-page-field" />
                           <Button fx:id="goToPageBtn" styleClass="pagination-btn" text="➡" />
                        </children>
                     </HBox>
                  </children>
                  <padding>
                     <Insets bottom="10.0" left="20.0" right="20.0" top="10.0" />
                  </padding>
               </HBox>

            </children>
            <padding>
               <Insets bottom="20.0" left="20.0" right="20.0" top="20.0" />
            </padding>
         </VBox>

      </children>
      <padding>
         <Insets left="20.0" right="20.0" top="20.0" bottom="20.0" />
      </padding>
   </VBox>
</ScrollPane>