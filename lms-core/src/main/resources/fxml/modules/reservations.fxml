<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.Button?>
<?import javafx.scene.control.ComboBox?>
<?import javafx.scene.control.Label?>
<?import javafx.scene.control.ScrollPane?>
<?import javafx.scene.control.Tab?>
<?import javafx.scene.control.TabPane?>
<?import javafx.scene.control.TableColumn?>
<?import javafx.scene.control.TableView?>
<?import javafx.scene.control.TextField?>
<?import javafx.scene.layout.ColumnConstraints?>
<?import javafx.scene.layout.GridPane?>
<?import javafx.scene.layout.HBox?>
<?import javafx.scene.layout.Region?>
<?import javafx.scene.layout.RowConstraints?>
<?import javafx.scene.layout.VBox?>

<ScrollPane styleClass="module-container" stylesheets="@../../styles/modules.css" xmlns="http://javafx.com/javafx/23.0.1" xmlns:fx="http://javafx.com/fxml/1" fx:controller="com.lms.controller.modules.ReservationController">

   <VBox spacing="25.0" styleClass="module-container">
      <children>

         <!-- Header Section -->
         <HBox alignment="CENTER_LEFT" spacing="15.0" styleClass="module-header">
            <children>
               <Label styleClass="module-icon" text="📝" />
               <VBox>
                  <children>
                     <Label styleClass="module-title" text="Reservation Management" />
                     <Label styleClass="module-subtitle" text="Manage book and seat reservations" />
                  </children>
               </VBox>
               <Region HBox.hgrow="ALWAYS" />
            </children>
            <padding>
               <Insets bottom="20.0" left="20.0" right="20.0" top="10.0" />
            </padding>
         </HBox>

         <!-- Statistics Cards -->
         <GridPane hgap="15.0" styleClass="stats-container" vgap="15.0">
            <columnConstraints>
               <ColumnConstraints hgrow="SOMETIMES" minWidth="10.0" />
               <ColumnConstraints hgrow="SOMETIMES" minWidth="10.0" />
               <ColumnConstraints hgrow="SOMETIMES" minWidth="10.0" />
               <ColumnConstraints hgrow="SOMETIMES" minWidth="10.0" />
               <ColumnConstraints hgrow="SOMETIMES" minWidth="10.0" />
               <ColumnConstraints hgrow="SOMETIMES" minWidth="10.0" />
               <ColumnConstraints hgrow="SOMETIMES" minWidth="10.0" />
               <ColumnConstraints hgrow="SOMETIMES" minWidth="10.0" />
            </columnConstraints>
            <rowConstraints>
               <RowConstraints minHeight="10.0" vgrow="SOMETIMES" />
            </rowConstraints>
            <children>

               <!-- Total Book Reservations -->
               <VBox alignment="CENTER" styleClass="stat-card, stat-card-primary" GridPane.columnIndex="0">
                  <children>
                     <Label fx:id="totalBookReservationsLabel" styleClass="stat-number" text="0" />
                     <Label styleClass="stat-label" text="Book Reservations" />
                  </children>
               </VBox>

               <!-- Active Book Reservations -->
               <VBox alignment="CENTER" styleClass="stat-card, stat-card-info" GridPane.columnIndex="1">
                  <children>
                     <Label fx:id="activeBookReservationsLabel" styleClass="stat-number" text="0" />
                     <Label styleClass="stat-label" text="Active Book" />
                  </children>
               </VBox>

               <!-- Expired Book Reservations -->
               <VBox alignment="CENTER" styleClass="stat-card, stat-card-warning" GridPane.columnIndex="2">
                  <children>
                     <Label fx:id="expiredBookReservationsLabel" styleClass="stat-number" text="0" />
                     <Label styleClass="stat-label" text="Expired Book" />
                  </children>
               </VBox>

               <!-- Fulfilled Book Reservations -->
               <VBox alignment="CENTER" styleClass="stat-card, stat-card-success" GridPane.columnIndex="3">
                  <children>
                     <Label fx:id="fulfilledBookReservationsLabel" styleClass="stat-number" text="0" />
                     <Label styleClass="stat-label" text="Fulfilled Book" />
                  </children>
               </VBox>

               <!-- Total Seat Reservations -->
               <VBox alignment="CENTER" styleClass="stat-card, stat-card-secondary" GridPane.columnIndex="4">
                  <children>
                     <Label fx:id="totalSeatReservationsLabel" styleClass="stat-number" text="0" />
                     <Label styleClass="stat-label" text="Seat Reservations" />
                  </children>
               </VBox>

               <!-- Active Seat Reservations -->
               <VBox alignment="CENTER" styleClass="stat-card, stat-card-info" GridPane.columnIndex="5">
                  <children>
                     <Label fx:id="activeSeatReservationsLabel" styleClass="stat-number" text="0" />
                     <Label styleClass="stat-label" text="Active Seat" />
                  </children>
               </VBox>

               <!-- Ongoing Seat Reservations -->
               <VBox alignment="CENTER" styleClass="stat-card, stat-card-danger" GridPane.columnIndex="6">
                  <children>
                     <Label fx:id="ongoingSeatReservationsLabel" styleClass="stat-number" text="0" />
                     <Label styleClass="stat-label" text="Ongoing Seat" />
                  </children>
               </VBox>

               <!-- Available Seats -->
               <VBox alignment="CENTER" styleClass="stat-card, stat-card-success" GridPane.columnIndex="7">
                  <children>
                     <Label fx:id="availableSeatsLabel" styleClass="stat-number" text="0" />
                     <Label styleClass="stat-label" text="Available Seats" />
                  </children>
               </VBox>

            </children>
         </GridPane>

         <!-- Tab Pane for Book and Seat Reservations -->
         <TabPane fx:id="reservationTabPane" styleClass="dark-tab-pane" VBox.vgrow="ALWAYS">

            <!-- Book Reservations Tab -->
            <Tab fx:id="bookReservationsTab" closable="false" text="📚 Book Reservations">
               <content>
                  <VBox spacing="20.0" styleClass="tab-content">
                     <children>

                        <!-- Search and Filter Section -->
                        <HBox alignment="CENTER_LEFT" spacing="15.0" styleClass="filter-section">
                           <children>
                              <!-- Search Field -->
                              <VBox spacing="5.0">
                                 <children>
                                    <Label styleClass="filter-label" text="Search Book Reservations" />
                                    <TextField fx:id="bookSearchField" prefWidth="300.0" promptText="Search by member name, email, or book title..." styleClass="search-field" />
                                 </children>
                              </VBox>

                              <!-- Status Filter -->
                              <VBox spacing="5.0">
                                 <children>
                                    <Label styleClass="filter-label" text="Filter by Status" />
                                    <ComboBox fx:id="bookStatusFilter" prefWidth="150.0" styleClass="filter-combo" />
                                 </children>
                              </VBox>

                              <Region HBox.hgrow="ALWAYS" />

                              <!-- Page Size Selection -->
                              <VBox spacing="5.0">
                                 <children>
                                    <Label styleClass="filter-label" text="Page Size" />
                                    <ComboBox fx:id="bookPageSizeCombo" prefWidth="80.0" styleClass="filter-combo" />
                                 </children>
                              </VBox>

                              <!-- Action Buttons -->
                              <HBox spacing="10.0" styleClass="action-buttons">
                                 <children>
                                    <Button fx:id="clearBookFiltersButton" mnemonicParsing="false" onAction="#handleClearBookFilters" prefHeight="35.0" styleClass="secondary-button" text="Clear Filters">
                                       <HBox.margin>
                                          <Insets top="22.0" />
                                       </HBox.margin>
                                    </Button>
                                    <Button fx:id="createBookReservationButton" mnemonicParsing="false" onAction="#handleCreateBookReservation" prefHeight="35.0" styleClass="primary-button" text="➕ Reserve Book">
                                       <HBox.margin>
                                          <Insets top="22.0" />
                                       </HBox.margin>
                                    </Button>
                                 </children>
                              </HBox>
                           </children>
                           <padding>
                              <Insets bottom="15.0" left="20.0" right="20.0" top="15.0" />
                           </padding>
                        </HBox>

                        <!-- Book Reservations Table Section -->
                        <VBox spacing="10.0" styleClass="table-section" VBox.vgrow="ALWAYS">
                           <children>

                              <!-- Table Actions -->
                              <HBox alignment="CENTER_LEFT" spacing="10.0" styleClass="table-actions">
                                 <children>
                                    <Label styleClass="table-info" text="Select a book reservation to perform actions:" />

                                    <Region HBox.hgrow="ALWAYS" />

                                    <Button fx:id="refreshBookButton" mnemonicParsing="false" onAction="#handleRefreshBook" prefHeight="35.0" styleClass="btn-secondary" text="🔄" />
                                    <Button fx:id="viewBookReservationButton" disable="true" mnemonicParsing="false" onAction="#handleViewBookReservation" prefHeight="35.0" styleClass="btn-secondary" text="👁" />
                                    <Button fx:id="fulfillBookReservationButton" disable="true" mnemonicParsing="false" onAction="#handleFulfillBookReservation" prefHeight="35.0" styleClass="btn-secondary" text="✅" />
                                    <Button fx:id="cancelBookReservationButton" disable="true" mnemonicParsing="false" onAction="#handleCancelBookReservation" prefHeight="35.0" styleClass="btn-danger" text="❌" />
                                 </children>
                              </HBox>

                              <!-- Book Reservations Table -->
                              <TableView fx:id="bookReservationsTable" styleClass="data-table" VBox.vgrow="ALWAYS">
                                 <columns>
                                    <TableColumn fx:id="bookResIdColumn" prefWidth="60.0" text="ID" />
                                    <TableColumn fx:id="bookResMemberColumn" prefWidth="180.0" text="Member" />
                                    <TableColumn fx:id="bookResBookColumn" prefWidth="200.0" text="Book" />
                                    <TableColumn fx:id="bookResDateColumn" prefWidth="120.0" text="Reserved" />
                                    <TableColumn fx:id="bookResExpiryColumn" prefWidth="120.0" text="Expires" />
                                    <TableColumn fx:id="bookResStatusColumn" prefWidth="100.0" text="Status" />
                                    <TableColumn fx:id="bookResQueueColumn" prefWidth="80.0" text="Queue" />
                                 </columns>
                                 <columnResizePolicy>
                                    <TableView fx:constant="CONSTRAINED_RESIZE_POLICY" />
                                 </columnResizePolicy>
                              </TableView>

                              <!-- Book Reservations Pagination -->
                              <HBox alignment="CENTER" spacing="15.0" styleClass="pagination-section">
                                 <children>
                                    <!-- Navigation Buttons -->
                                    <HBox spacing="5.0" styleClass="pagination-nav">
                                       <children>
                                          <Button fx:id="bookFirstPageBtn" styleClass="pagination-btn" text="⏮" />
                                          <Button fx:id="bookPreviousPageBtn" styleClass="pagination-btn" text="◀" />
                                          <Button fx:id="bookNextPageBtn" styleClass="pagination-btn" text="▶" />
                                          <Button fx:id="bookLastPageBtn" styleClass="pagination-btn" text="⏭" />
                                       </children>
                                    </HBox>

                                    <!-- Page Information -->
                                    <Label fx:id="bookPageInfoLabel" styleClass="page-info" text="Page 1 of 1 (1-25 of 25 records)" />

                                    <Region HBox.hgrow="ALWAYS" />

                                    <!-- Go to Page -->
                                    <HBox alignment="CENTER_RIGHT" spacing="5.0" styleClass="goto-page">
                                       <children>
                                          <Label styleClass="pagination-label" text="Go to page:" />
                                          <TextField fx:id="bookGoToPageField" prefWidth="60.0" promptText="1" styleClass="goto-page-field" />
                                          <Button fx:id="bookGoToPageBtn" styleClass="pagination-btn" text="➡" />
                                       </children>
                                    </HBox>
                                 </children>
                                 <padding>
                                    <Insets bottom="10.0" left="20.0" right="20.0" top="10.0" />
                                 </padding>
                              </HBox>

                           </children>
                           <padding>
                              <Insets bottom="20.0" left="20.0" right="20.0" top="20.0" />
                           </padding>
                           <VBox.margin>
                              <Insets />
                           </VBox.margin>
                        </VBox>

                     </children>
                     <padding>
                        <Insets top="10.0" />
                     </padding>
                  </VBox>
               </content>
            </Tab>

            <!-- Seat Reservations Tab -->
            <Tab fx:id="seatReservationsTab" closable="false" text="💺 Seat Reservations">
               <content>
                  <VBox spacing="20.0" styleClass="tab-content">
                     <children>

                        <!-- Search and Filter Section -->
                        <HBox alignment="CENTER_LEFT" spacing="15.0" styleClass="filter-section">
                           <children>
                              <!-- Search Field -->
                              <VBox spacing="5.0">
                                 <children>
                                    <Label styleClass="filter-label" text="Search Seat Reservations" />
                                    <TextField fx:id="seatSearchField" prefWidth="300.0" promptText="Search by member name, email, or seat location..." styleClass="search-field" />
                                 </children>
                              </VBox>

                              <!-- Status Filter -->
                              <VBox spacing="5.0">
                                 <children>
                                    <Label styleClass="filter-label" text="Filter by Status" />
                                    <ComboBox fx:id="seatStatusFilter" prefWidth="150.0" styleClass="filter-combo" />
                                 </children>
                              </VBox>

                              <Region HBox.hgrow="ALWAYS" />

                              <!-- Page Size Selection -->
                              <VBox spacing="5.0">
                                 <children>
                                    <Label styleClass="filter-label" text="Page Size" />
                                    <ComboBox fx:id="seatPageSizeCombo" prefWidth="80.0" styleClass="filter-combo" />
                                 </children>
                              </VBox>

                              <!-- Action Buttons -->
                              <HBox spacing="10.0" styleClass="action-buttons">
                                 <children>
                                    <Button fx:id="clearSeatFiltersButton" mnemonicParsing="false" onAction="#handleClearSeatFilters" prefHeight="35.0" styleClass="secondary-button" text="Clear Filters">
                                       <HBox.margin>
                                          <Insets top="22.0" />
                                       </HBox.margin>
                                    </Button>
                                    <Button fx:id="createSeatReservationButton" mnemonicParsing="false" onAction="#handleCreateSeatReservation" prefHeight="35.0" styleClass="primary-button" text="💺 Reserve Seat">
                                       <HBox.margin>
                                          <Insets top="22.0" />
                                       </HBox.margin>
                                    </Button>
                                 </children>
                              </HBox>
                           </children>
                           <padding>
                              <Insets bottom="15.0" left="20.0" right="20.0" top="15.0" />
                           </padding>
                        </HBox>

                        <!-- Seat Reservations Table Section -->
                        <VBox spacing="10.0" styleClass="table-section" VBox.vgrow="ALWAYS">
                           <children>

                              <!-- Table Actions -->
                              <HBox alignment="CENTER_LEFT" spacing="10.0" styleClass="table-actions">
                                 <children>
                                    <Label styleClass="table-info" text="Select a seat reservation to perform actions:" />

                                    <Region HBox.hgrow="ALWAYS" />

                                    <Button fx:id="refreshSeatButton" mnemonicParsing="false" onAction="#handleRefreshSeat" prefHeight="35.0" styleClass="btn-secondary" text="🔄" />
                                    <Button fx:id="viewSeatReservationButton" disable="true" mnemonicParsing="false" onAction="#handleViewSeatReservation" prefHeight="35.0" styleClass="btn-secondary" text="👁" />
                                    <Button fx:id="cancelSeatReservationButton" disable="true" mnemonicParsing="false" onAction="#handleCancelSeatReservation" prefHeight="35.0" styleClass="btn-danger" text="❌" />
                                 </children>
                              </HBox>

                              <!-- Seat Reservations Table -->
                              <TableView fx:id="seatReservationsTable" styleClass="data-table" VBox.vgrow="ALWAYS">
                                 <columns>
                                    <TableColumn fx:id="seatResMemberColumn" prefWidth="180.0" text="Member" />
                                    <TableColumn fx:id="seatResSeatColumn" prefWidth="150.0" text="Seat" />
                                    <TableColumn fx:id="seatResStartColumn" prefWidth="120.0" text="Start Time" />
                                    <TableColumn fx:id="seatResEndColumn" prefWidth="120.0" text="End Time" />
                                    <TableColumn fx:id="seatResDurationColumn" prefWidth="100.0" text="Duration" />
                                    <TableColumn fx:id="seatResStatusColumn" prefWidth="150.0" text="Status" />
                                 </columns>
                                 <columnResizePolicy>
                                    <TableView fx:constant="CONSTRAINED_RESIZE_POLICY" />
                                 </columnResizePolicy>
                              </TableView>

                              <!-- Seat Reservations Pagination -->
                              <HBox alignment="CENTER" spacing="15.0" styleClass="pagination-section">
                                 <children>
                                    <!-- Navigation Buttons -->
                                    <HBox spacing="5.0" styleClass="pagination-nav">
                                       <children>
                                          <Button fx:id="seatFirstPageBtn" styleClass="pagination-btn" text="⏮" />
                                          <Button fx:id="seatPreviousPageBtn" styleClass="pagination-btn" text="◀" />
                                          <Button fx:id="seatNextPageBtn" styleClass="pagination-btn" text="▶" />
                                          <Button fx:id="seatLastPageBtn" styleClass="pagination-btn" text="⏭" />
                                       </children>
                                    </HBox>

                                    <!-- Page Information -->
                                    <Label fx:id="seatPageInfoLabel" styleClass="page-info" text="Page 1 of 1 (1-25 of 25 records)" />

                                    <Region HBox.hgrow="ALWAYS" />

                                    <!-- Go to Page -->
                                    <HBox alignment="CENTER_RIGHT" spacing="5.0" styleClass="goto-page">
                                       <children>
                                          <Label styleClass="pagination-label" text="Go to page:" />
                                          <TextField fx:id="seatGoToPageField" prefWidth="60.0" promptText="1" styleClass="goto-page-field" />
                                          <Button fx:id="seatGoToPageBtn" styleClass="pagination-btn" text="➡" />
                                       </children>
                                    </HBox>
                                 </children>
                                 <padding>
                                    <Insets bottom="10.0" left="20.0" right="20.0" top="10.0" />
                                 </padding>
                              </HBox>

                           </children>
                           <padding>
                              <Insets bottom="20.0" left="20.0" right="20.0" top="20.0" />
                           </padding>
                        </VBox>

                     </children>
                     <padding>
                        <Insets top="10.0" />
                     </padding>
                  </VBox>
               </content>
            </Tab>

         </TabPane>

      </children>
      <padding>
         <Insets left="20.0" right="20.0" top="20.0" />
      </padding>
   </VBox>

</ScrollPane>
